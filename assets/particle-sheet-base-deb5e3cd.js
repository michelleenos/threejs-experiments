import{a as x}from"./lil-gui.esm-ee8b5e9f.js";import{M as D}from"./Mouse-e226e203.js";import{W as E}from"./World-b0ac075c.js";import{c as u}from"./dom-8613d0e9.js";import{V as w,v as c,f as p,h as V,x as b,B as _,i as g,S as H,w as m,b as M,t as B,_ as L,a as z,Z as A,o as F,j as O,ad as k,ae as G,E as N}from"./three.core-cdbdf8aa.js";import{S as U}from"./sizes-40a94193.js";import{g as W}from"./generate-points-sheet-412bec60.js";const X="modulepreload",Y=function(d){return"/threejs-experiments/"+d},S={},ee=function(e,t,s){if(!t||t.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(a=>{if(a=Y(a),a in S)return;S[a]=!0;const o=a.endsWith(".css"),r=o?'[rel="stylesheet"]':"";if(!!s)for(let h=i.length-1;h>=0;h--){const l=i[h];if(l.href===a&&(!o||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${r}`))return;const n=document.createElement("link");if(n.rel=o?"stylesheet":X,o||(n.as="script",n.crossOrigin=""),n.href=a,document.head.appendChild(n),o)return new Promise((h,l)=>{n.addEventListener("load",h),n.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>e()).catch(a=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a})},te=(d,e)=>{const t=d[e];return t?typeof t=="function"?t():Promise.resolve(t):new Promise((s,i)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(i.bind(null,new Error("Unknown variable dynamic import: "+e)))})};class v{gui;storedVals={};storageKey;children=[];constructor(e,t){this.gui=t||new x,this.storageKey=e,this.storedVals=localStorage.getItem(e)?JSON.parse(localStorage.getItem(e)):{},this.gui.onChange(s=>{if(s.controller.parent===this.gui){let a=s.controller.domElement.getAttribute("data-ls-key");a&&(this.storedVals[a]=s.value,this.setStorage())}}),this.setExpandCollapse()}setExpandCollapse=()=>{this.storedVals.expanded?this.gui.open():this.gui.close(),this.gui.onOpenClose(()=>{console.log("openclose"),this.storedVals.expanded=!this.gui._closed,this.setStorage()})};add=(e,t,s=[],i=t,a=!0)=>{if(e[t]instanceof w)return[...this.add(e[t],"x",[...s],`${i}X`),...this.add(e[t],"y",[...s],`${i}Y`),...this.add(e[t],"z",[...s],`${i}Z`)];if(e[t]instanceof c)return[...this.add(e[t],"x",[...s],`${i}X`),...this.add(e[t],"y",[...s],`${i}Y`)];a&&this.storedVals.hasOwnProperty(i)?e[t]=this.storedVals[i]:(this.storedVals[i]=e[t],this.setStorage());let o=this.gui.add(e,t,...s).name(i);return o.domElement.setAttribute("data-ls-key",i),[o]};addColor=(e,t,s=t)=>{this.storedVals.hasOwnProperty(s)?e[t]=new p(this.storedVals[s]):(this.storedVals[s]=`#${e[t].getHexString()}`,this.setStorage());let i={[t]:e[t].getHexString()},a=this.gui.addColor(i,t).name(s).onChange(o=>{e[t]=new p(o)});return a.domElement.setAttribute("data-ls-key",s),a};addFolder=e=>{let t=this.gui.addFolder(e),s=new v(`${this.storageKey}-${e}`,t);return this.children.push(s),s};setStorage=()=>{localStorage.setItem(this.storageKey,JSON.stringify(this.storedVals))};resetVals=(e=!0)=>{this.storedVals={},this.setStorage(),this.children.forEach(t=>t.resetVals(!1)),e&&window.location.reload()};cameraControls=e=>{let t=this.addFolder("camera");return t.add(e.position,"x",[],"cameraX")[0].decimals(3).listen(),t.add(e.position,"y",[],"cameraY")[0].decimals(3).listen(),t.add(e.position,"z",[],"cameraZ")[0].decimals(3).listen(),t.add(e,"fov",[1,180,1],"fov")[0].listen().name("fov").onChange(()=>{e.updateProjectionMatrix()}),t};exportVals=()=>{let e=new Date,t=`${e.getMonth()+1}${e.getDate()}${e.getHours()}${e.getMinutes()}`,s=this.gui.save(),i=JSON.stringify(s,null,2),a=new Blob([i],{type:"application/json"}),o=URL.createObjectURL(a),r=document.createElement("a");r.href=o,r.download=`${this.storageKey}-${t}.json`,r.click()}}class R extends V{world;mouse;sizes;raycaster=new b;geometry;material;vertexShader;fragmentShader;planeHelper;params;mouseLerp=.1;constructor(e){super(),this.world=e.world,this.sizes=e.world.sizes,this.mouse=e.mouse,this.params=e.sheetParams,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.geometry=this.createGeometry(),this.material=this.createMaterial(),this.planeHelper=this.createHelper(),this.world.scene.add(this),this.params.scale&&this.scale.copy(this.params.scale),e.mouseLerp&&(this.mouseLerp=e.mouseLerp)}raycast=()=>{this.raycaster.setFromCamera(this.mouse.pos,this.world.camera);const e=this.raycaster.intersectObjects([this.planeHelper]);if(e[0]&&e[0].uv){const t=new c().copy(e[0].uv);t.multiplyScalar(2),t.addScalar(-.5),this.material.uniforms.u_mouse.value.lerp(t,this.mouseLerp)}};createGeometry=()=>{const{positions:e,scales:t,uvs:s}=W(this.params.sheetWidth,this.params.sheetHeight,this.params.nx,this.params.ny);let i=new _;return i.setAttribute("position",new g(e,3)),i.setAttribute("scale",new g(t,1)),i.setAttribute("uv",new g(s,2)),i};setUniforms=e=>{this.material.uniforms={...this.material.uniforms,...e}};createMaterial=()=>new H({uniforms:{u_time:{value:0},u_mouse:new m(new c(.5,.5)),u_res:new m(new c(this.sizes.width*this.sizes.pixelRatio,this.sizes.height*this.sizes.pixelRatio)),u_planeRes:new m(new c(this.params.sheetWidth,this.params.sheetHeight))},vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,transparent:!0,depthWrite:!1});createHelper=()=>{let e=new M(new B(this.params.sheetWidth*2,this.params.sheetHeight*2),new L({color:16711680,transparent:!0,opacity:.5,side:z}));return e.visible=!0,e};dispose=()=>{this.world.scene.remove(this),this.geometry.dispose(),this.material.dispose(),this.planeHelper&&(this.world.scene.remove(this.planeHelper),this.planeHelper.geometry.dispose(),this.planeHelper.material.dispose())};update=e=>{this.raycast(),this.material.uniforms.u_time.value=e}}class se{baseKey="particles";world;sizes;mouse;clock=new A;defaultCameraPos=new w(0,0,18);particles=[];rafId=null;viewData;viewDataIndex=-1;viewDataCurrent;colors=[new p("#FF8D25"),new p("#0067A7")];viewBtns;gui=null;gls=null;glsCameraControls=null;cameraListening=!1;constructor(e){e.key&&(this.baseKey=e.key),this.sizes=new U,this.world=new E(this.sizes),this.mouse=new D(this.sizes),this.world.camera.position.copy(this.defaultCameraPos),this.world.camera.far=100,this.world.camera.fov=35,this.world.camera.updateProjectionMatrix(),this.world.controls&&(this.world.controls.enableDamping=!1),this.viewData=e.data,this.viewData.length>1&&(this.viewBtns=this.makeViewChooser());let t=parseInt(localStorage.getItem(`${this.baseKey}-view`)||"0");this.setViewDataIndex(t)}get currentKey(){let e=this.viewData[this.viewDataIndex];return`${this.baseKey}-${e.key||this.viewDataIndex}`}setCameraVals=()=>{let e=this.viewDataCurrent;if(e){if(!e.saveCamera)this.world.camera.position.copy(this.defaultCameraPos),this.cameraListening=!1;else{try{let t=localStorage.getItem(`${this.currentKey}-camera`),s=JSON.parse(t);s.cameraX!==void 0&&s.cameraY!==void 0&&s.cameraZ!==void 0?this.world.camera.position.set(s.cameraX,s.cameraY,s.cameraZ):this.world.camera.position.copy(this.defaultCameraPos),s.fov!==void 0&&(this.world.camera.fov=s.fov,this.world.camera.updateProjectionMatrix())}catch{this.world.camera.position.copy(this.defaultCameraPos)}this.cameraListening=!0}this.world.camera.lookAt(0,0,0)}};setViewDataIndex=e=>{e>=this.viewData.length&&(e=0),e!==this.viewDataIndex&&(this.viewDataIndex=e,this.viewDataCurrent=JSON.parse(JSON.stringify(this.viewData[this.viewDataIndex])),this.viewBtns?.forEach(t=>t.classList.remove("active")),this.viewBtns?.[this.viewDataIndex].classList.add("active"),localStorage.setItem(`${this.baseKey}-view`,`${this.viewDataIndex}`),this.getParams())};restart=()=>{this.particles.length&&(this.particles.forEach(e=>{e.dispose()}),this.particles=[]),this.gui?.destroy(),this.gls=null,this.gui=null,this.stop(),setTimeout(()=>{this.createAll(),this.start()})};makeViewChooser=()=>{let e=u("div",{class:"views"}),t=[];return this.viewData.forEach((s,i)=>{let a=u("span",{class:"views__title"},s.key||`view ${i}`),o=u("span",{class:"views__num"},`${i+1}`),r=u("button",{class:"views__btn","data-index":`${i}`},[o,a]);e.appendChild(r),t.push(r)}),document.body.appendChild(e),e.addEventListener("click",s=>{let a=s.target.closest(".views__btn");if(!a)return;let o=a.dataset.index;o!==void 0&&(this.setViewDataIndex(parseInt(o)),this.restart())}),t};createAll=()=>{let e=this.viewDataCurrent;if(!e){console.warn("no current view data");return}this.setupGui(),e.sheets.forEach(t=>{this.particles.push(new R({world:this.world,mouse:this.mouse,sheetParams:t.params,vertexShader:t.material.vertexShader,fragmentShader:t.material.fragmentShader}))}),this.setCameraVals(),this.setUniforms(),this.setGeometryStuff(),this.setParticlesGui()};setupGui=()=>{this.gui=new x,this.gls=new v(this.currentKey,this.gui),this.gui.add(this,"resetCamera"),this.gui.add(this.gls,"resetVals"),this.gui.add(this.gls,"exportVals"),this.glsCameraControls=this.gls.cameraControls(this.world.camera)};resetCamera=()=>{localStorage.removeItem(`${this.currentKey}-camera`),this.setCameraVals()};onParamsChange=()=>{setTimeout(()=>this.restart())};setGeometryStuff=()=>{if(!this.particles)return console.warn("no particles, cant set geometry stuff");this.viewData[this.viewDataIndex].sheets.forEach((t,s)=>{let i=t.params;i.position&&this.particles[s].position.copy(i.position),i.rotation&&this.particles[s].rotation.copy(i.rotation),i.blending?.default&&(this.particles[s].material.blending=i.blending.default)})};setUniforms=()=>{let e=this.viewData[this.viewDataIndex];if(!this.particles)return console.warn("no particles, cant set uniforms");if(!this.gls)return console.warn("no gls");e.sheets.forEach((t,s)=>{let{setVals:i=!0,colors:a=this.colors}=t,o=t.material.uniforms;if(!this.particles[s])return;let r=this.particles.length>1?`uniforms-${s}`:"uniforms",f=this.gls.addFolder(r),n=this.particles[s].material;o.forEach(h=>{let[l,I,C,P,$]=h,y=`u_${l}`;this.particles[s].setUniforms({[y]:new m(I)}),typeof C=="number"&&f.add(n.uniforms[y],"value",[C,P,$],l,i)}),a.forEach((h,l)=>{this.particles[s].setUniforms({[`u_color${l+1}`]:new m(h)}),f.addColor(n.uniforms[`u_color${l+1}`],"value",`color${l+1}`)})})};setParticlesGui=()=>{if(!this.gls||!this.gui||!this.particles.length)return;this.viewDataCurrent.sheets.forEach((t,s)=>{if(!this.particles[s])return;let i=this.viewDataCurrent.sheets.length>1?`params-${s}`:"params",a=this.gls.addFolder(i),{params:o,setVals:r}=t;a.add(o,"sheetWidth",[1,20,1],"sheetWidth",r)[0].onFinishChange(this.onParamsChange),a.add(o,"sheetHeight",[1,20,1],"sheetHeight",r)[0].onFinishChange(this.onParamsChange),a.add(o,"nx",[1,500,1],"particlesX",r)[0].onFinishChange(this.onParamsChange),a.add(o,"ny",[1,500,1],"particlesY",r)[0].onFinishChange(this.onParamsChange),o.position&&(a.add(this.particles[s].position,"x",[-10,10,.1],"posX",r),a.add(this.particles[s].position,"y",[-10,10,.1],"posY",r),a.add(this.particles[s].position,"z",[-10,10,.1],"posZ",r)),o.rotation&&(a.add(this.particles[s].rotation,"x",[-Math.PI,Math.PI,.01],"rotX",r),a.add(this.particles[s].rotation,"y",[-Math.PI,Math.PI,.01],"rotY",r),a.add(this.particles[s].rotation,"z",[-Math.PI,Math.PI,.01],"rotZ",r)),a.add(this.particles[s],"visible"),o.blending?.controls&&a.add(this.particles[s].material,"blending",[{normal:F,additive:O,subtractive:k,multiply:G}])})};getParams=()=>{let e=this.viewDataCurrent;e.sheets.forEach((t,s)=>{let{setVals:i=!0,params:a}=t,o=e.sheets.length>1?`params-${s}`:"params",r=JSON.parse(localStorage.getItem(`${this.currentKey}-${o}`));r&&i&&(r.sheetWidth&&(a.sheetWidth=r.sheetWidth),r.sheetHeight&&(a.sheetHeight=r.sheetHeight),r.particlesX&&(a.nx=r.particlesX),r.particlesY&&(a.ny=r.particlesY),a.position&&r.position&&(a.position=new w().copy(r.position)),a.rotation&&r.rotation&&(a.rotation=new N().copy(r.rotation)))})};update=e=>{if(this.particles.length&&this.particles.forEach(t=>t.update(e)),this.world.render(),this.cameraListening&&this.glsCameraControls){let t=this.glsCameraControls.gui.save(),s=localStorage.getItem(`${this.currentKey}-camera`),i=s?JSON.parse(s):{};i.cameraX=t.controllers.cameraX,i.cameraY=t.controllers.cameraY,i.cameraZ=t.controllers.cameraZ,localStorage.setItem(`${this.currentKey}-camera`,JSON.stringify(i))}};tick=()=>{let e=this.clock.getElapsedTime();this.update(e),this.rafId=requestAnimationFrame(this.tick)};start=()=>{this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(this.tick)};stop=()=>{this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=null}}export{se as P,te as _,ee as a};
